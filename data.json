// DS TEXTILE - Order Updates Script
// This script loads order data from data.json and displays it on the page

// DOM Elements
const ordersGrid = document.getElementById('ordersGrid');
const lastUpdatedElement = document.getElementById('lastUpdated');
const totalOrdersElement = document.getElementById('totalOrders');
const refreshBtn = document.getElementById('refreshBtn');
const loadingElement = document.getElementById('loading');
const errorElement = document.getElementById('error');

// Load orders when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadOrders();
});

// Refresh button click handler
refreshBtn.addEventListener('click', function() {
    refreshBtn.classList.add('spinning');
    refreshBtn.disabled = true;
    
    // Reload orders
    loadOrders().finally(function() {
        setTimeout(function() {
            refreshBtn.classList.remove('spinning');
            refreshBtn.disabled = false;
        }, 500);
    });
});

/**
 * Load orders from data.json file
 */
function loadOrders() {
    return new Promise(function(resolve, reject) {
        // Show loading state
        loadingElement.style.display = 'block';
        errorElement.style.display = 'none';
        ordersGrid.style.display = 'none';
        
        // Fetch data from data.json
        fetch('data.json')
            .then(function(response) {
                if (!response.ok) {
                    throw new Error('Failed to load data.json');
                }
                return response.json();
            })
            .then(function(data) {
                // Update last updated time
                lastUpdatedElement.textContent = data.lastUpdated;
                
                // Update total orders count
                totalOrdersElement.textContent = data.orders.length;
                
                // Display orders
                displayOrders(data.orders);
                
                // Hide loading, show grid
                loadingElement.style.display = 'none';
                ordersGrid.style.display = 'grid';
                
                resolve(data);
            })
            .catch(function(error) {
                console.error('Error loading orders:', error);
                
                // Show error state
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                ordersGrid.style.display = 'none';
                
                reject(error);
            });
    });
}

/**
 * Display orders in grid
 * @param {Array} orders - Array of order objects
 */
function displayOrders(orders) {
    // Clear existing content
    ordersGrid.innerHTML = '';
    
    // Check if orders exist
    if (!orders || orders.length === 0) {
        ordersGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #fbbf24;">No orders found</div>';
        ordersGrid.style.display = 'grid';
        return;
    }
    
    // Loop through each order and create cards
    for (var i = 0; i < orders.length; i++) {
        var card = createOrderCard(orders[i]);
        ordersGrid.appendChild(card);
    }
}

/**
 * Create an order card element
 * @param {Object} order - Order object
 * @returns {HTMLElement} Card element
 */
function createOrderCard(order) {
    var card = document.createElement('div');
    card.className = 'order-card';
    
    // Determine payment badge class
    var paymentClass = order.payment.indexOf('Online') !== -1 ? 'payment-online' : 'payment-cod';
    
    // Build card HTML
    card.innerHTML = `
        <!-- Order Header -->
        <div class="order-header">
            <div class="order-number">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                Order No ` + order.orderNo + `
            </div>
            <span class="order-date">` + order.date + `</span>
        </div>

        <!-- Saree Image -->
        <div class="saree-image-container">
            <img src="` + order.sareeImage + `" alt="Saree - Order ` + order.orderNo + `" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2220%22%3EImage Not Found%3C/text%3E%3C/svg%3E'">
            <div class="image-label">üì¶ Saree Photo</div>
        </div>

        <!-- Customer Details -->
        <div class="customer-details">
            <!-- Customer Name -->
            <div class="customer-name-box">
                <p class="customer-name-label">Customer Name</p>
                <p class="customer-name">` + order.customer + `</p>
            </div>

            <!-- Details Grid -->
            <div class="details-grid">
                <div class="detail-box">
                    <p class="detail-label">üìû Phone</p>
                    <p class="detail-value">` + order.phone + `</p>
                </div>
                <div class="detail-box">
                    <p class="detail-label">üïê Time</p>
                    <p class="detail-value">` + order.time + `</p>
                </div>
                <div class="detail-box">
                    <p class="detail-label">üìç State</p>
                    <p class="detail-value">` + order.state + `</p>
                </div>
                <div class="detail-box">
                    <p class="detail-label">üí≥ Payment</p>
                    <span class="payment-badge ` + paymentClass + `">
                        ` + order.payment + `
                    </span>
                </div>
            </div>

            <!-- Payment Proof Section -->
            <div class="payment-proof-section">
                <div class="payment-proof-header">
                    <p class="payment-proof-title">üí∞ Payment Proof Screenshot</p>
                </div>
                <div class="payment-image-container">
                    <img src="` + order.paymentImage + `" alt="Payment Proof - Order ` + order.orderNo + `" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect width=%22400%22 height=%22300%22 fill=%22%23ddd%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2220%22%3EImage Not Found%3C/text%3E%3C/svg%3E'">
                    <div class="verified-badge">
                        <span style="font-size: 1.125rem;">‚úì</span>
                        <span>VERIFIED</span>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    return card;
}